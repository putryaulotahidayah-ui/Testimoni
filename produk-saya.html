<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Produk Saya | Netflix Invest</title>
  <style>
    :root {
      --black: #0a0a0a;
      --dark-gray: #1a1a1a;
      --card-bg: #141414;
      --red: #e50914;
      --dark-red: #b20710;
      --white: #ffffff;
      --light-gray: #b3b3b3;
      --green: #00c853;
      --orange: #ff9800;
      --gradient: linear-gradient(135deg, #e50914 0%, #b20710 100%);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', 'Helvetica Neue', Arial, sans-serif;
      background: var(--black);
      color: var(--white);
      min-height: 100vh;
      padding-bottom: 90px;
      line-height: 1.6;
    }

    /* Header */
    .header {
      background: var(--gradient);
      padding: 25px 20px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" opacity="0.1"><defs><pattern id="netflix" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><rect fill="white" width="20" height="20"/><path d="M0,0h20v20H0V0z M8,4h4v12h-4V4z" fill="%23e50914"/></pattern></defs><rect width="100" height="100" fill="url(%23netflix)"/></svg>');
    }

    .header h1 {
      font-size: 24px;
      font-weight: 700;
      position: relative;
      z-index: 2;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }

    /* Filter Tabs */
    .filter-tabs {
      display: flex;
      background: var(--dark-gray);
      margin: 0 20px;
      border-radius: 12px;
      overflow: hidden;
      margin-top: -15px;
      position: relative;
      z-index: 3;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .filter-tab {
      flex: 1;
      padding: 15px;
      text-align: center;
      background: transparent;
      border: none;
      color: var(--light-gray);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .filter-tab.active {
      background: var(--red);
      color: var(--white);
    }

    /* Container */
    .container {
      padding: 20px;
    }

    /* Product Cards */
    .product-card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .product-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 35px rgba(0, 0, 0, 0.6);
    }

    .product-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }

    .product-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--red);
    }

    .product-status {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
    }

    .status-active {
      background: var(--green);
      color: #000;
    }

    .status-completed {
      background: var(--light-gray);
      color: #000;
    }

    .product-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 15px;
    }

    .detail-item {
      display: flex;
      flex-direction: column;
    }

    .detail-label {
      font-size: 12px;
      color: var(--light-gray);
      margin-bottom: 4px;
    }

    .detail-value {
      font-size: 14px;
      font-weight: 600;
    }

    /* Progress Bar */
    .progress-section {
      margin: 15px 0;
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .progress-label {
      font-size: 14px;
      font-weight: 600;
    }

    .progress-percent {
      font-size: 12px;
      color: var(--light-gray);
    }

    .progress-bar {
      height: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: var(--gradient);
      border-radius: 4px;
      transition: width 0.5s ease;
    }

    /* Profit Summary */
    .profit-summary {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      background: rgba(229, 9, 20, 0.1);
      padding: 15px;
      border-radius: 12px;
      margin-top: 15px;
      border: 1px solid rgba(229, 9, 20, 0.2);
    }

    .profit-item {
      text-align: center;
    }

    .profit-label {
      font-size: 12px;
      color: var(--light-gray);
      margin-bottom: 4px;
    }

    .profit-value {
      font-size: 16px;
      font-weight: 700;
      color: var(--green);
    }

    /* Claim Button */
    .claim-section {
      margin-top: 15px;
      text-align: center;
    }

    .claim-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, var(--green), #00e676);
      color: #000;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 200, 83, 0.3);
    }

    .claim-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 200, 83, 0.5);
    }

    .claim-btn:disabled {
      background: var(--light-gray);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .claim-btn.claimed {
      background: var(--light-gray);
      color: var(--dark-gray);
    }

    /* Netflix Animation */
    .netflix-animation {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, #000000, #e50914, #000000);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      animation: netflixIntro 2s ease-in-out;
    }

    .netflix-logo {
      font-size: 72px;
      font-weight: 900;
      color: #e50914;
      text-transform: uppercase;
      letter-spacing: 8px;
      margin-bottom: 20px;
      text-shadow: 0 0 30px rgba(229, 9, 20, 0.8);
      animation: logoPulse 1s infinite alternate;
    }

    .profit-popup {
      background: rgba(0, 0, 0, 0.9);
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      border: 2px solid #e50914;
      box-shadow: 0 0 50px rgba(229, 9, 20, 0.5);
    }

    .profit-amount {
      font-size: 42px;
      font-weight: 900;
      color: var(--green);
      margin: 20px 0;
      text-shadow: 0 0 20px rgba(0, 200, 83, 0.7);
    }

    .profit-message {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    @keyframes netflixIntro {
      0% { opacity: 0; transform: scale(1.2); }
      50% { opacity: 1; transform: scale(1); }
      100% { opacity: 1; transform: scale(1); }
    }

    @keyframes logoPulse {
      0% { transform: scale(1); text-shadow: 0 0 30px rgba(229, 9, 20, 0.8); }
      100% { transform: scale(1.1); text-shadow: 0 0 50px rgba(229, 9, 20, 1); }
    }

    /* Loading Spinner */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--light-gray);
    }

    .empty-icon {
      font-size: 64px;
      margin-bottom: 20px;
      opacity: 0.5;
    }

    .empty-text {
      font-size: 16px;
      margin-bottom: 10px;
    }

    .empty-subtext {
      font-size: 14px;
      opacity: 0.7;
    }

    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: var(--card-bg);
      display: flex;
      justify-content: space-around;
      padding: 12px 0;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      z-index: 1000;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-decoration: none;
      color: var(--light-gray);
      transition: color 0.3s ease;
      flex: 1;
    }

    .nav-item.active {
      color: var(--red);
    }

    .nav-icon {
      width: 24px;
      height: 24px;
      margin-bottom: 4px;
      filter: brightness(0) invert(1);
    }

    .nav-item.active .nav-icon {
      filter: none;
    }

    .nav-label {
      font-size: 11px;
      font-weight: 500;
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
      animation: fadeIn 0.6s ease forwards;
    }

    /* Countdown Timer */
    .countdown-timer {
      background: rgba(255, 152, 0, 0.1);
      border: 1px solid rgba(255, 152, 0, 0.3);
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      margin: 10px 0;
      font-size: 14px;
    }

    .countdown-text {
      color: var(--orange);
      font-weight: 600;
    }

    /* Responsive */
    @media (max-width: 360px) {
      .product-details {
        grid-template-columns: 1fr;
      }
      
      .profit-summary {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <div class="header">
    <h1>Produk Saya</h1>
  </div>

  <!-- Filter Tabs -->
  <div class="filter-tabs">
    <button class="filter-tab active" onclick="filterProducts('all')">Semua</button>
    <button class="filter-tab" onclick="filterProducts('active')">Aktif</button>
    <button class="filter-tab" onclick="filterProducts('completed')">Selesai</button>
  </div>

  <!-- Container -->
  <div class="container" id="productsContainer">
    <!-- Produk akan di-load oleh JavaScript -->
  </div>

  <!-- Bottom Navigation -->
  <div class="bottom-nav">
    <a href="dashboard.html" class="nav-item">
      <img src="https://img.icons8.com/ios-filled/50/ffffff/home.png" class="nav-icon">
      <span class="nav-label">Beranda</span>
    </a>
    <a href="invest.html" class="nav-item">
      <img src="https://img.icons8.com/ios-filled/50/ffffff/investment.png" class="nav-icon">
      <span class="nav-label">Invest</span>
    </a>
    <a href="produk-saya.html" class="nav-item active">
      <img src="https://img.icons8.com/ios-filled/50/ffffff/package.png" class="nav-icon">
      <span class="nav-label">Produk</span>
    </a>
    <a href="user.html" class="nav-item">
      <img src="https://img.icons8.com/ios-filled/50/ffffff/user.png" class="nav-icon">
      <span class="nav-label">Profil</span>
    </a>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, get, update, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAuJSxpcFZ1QI-dEsEnx2qSqlb0wsvs6Mc",
  authDomain: "lginvest-776cf.firebaseapp.com",
  databaseURL: "https://lginvest-776cf-default-rtdb.firebaseio.com",
  projectId: "lginvest-776cf",
  storageBucket: "lginvest-776cf.firebasestorage.app",
  messagingSenderId: "831934282072",
  appId: "1:831934282072:web:6a8b7a5bcba5d4d1264d2d",
  measurementId: "G-265YF9DYCF"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Format Rupiah
function formatRupiah(n) {
  return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
}

// Format tanggal Indonesia
function formatDate(dateString) {
  const date = new Date(dateString);
  const options = { 
    day: '2-digit', 
    month: '2-digit', 
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  };
  return date.toLocaleDateString('id-ID', options);
}

// PERBAIKAN: Hitung selisih waktu dengan sistem 24 jam
function getHoursDifference(startDate, endDate) {
  const start = new Date(startDate);
  const end = new Date(endDate);
  const diffTime = end - start;
  return Math.floor(diffTime / (1000 * 60 * 60)); // Kembalikan dalam jam
}

// Fungsi profit yang kompatibel dengan invest.html
function getProfitPerDay(price) {
  if(price <= 125000) return Math.round(price * 0.12);
  if(price <= 300000) return Math.round(price * 0.125);
  if(price <= 450000) return Math.round(price * 0.13);
  if(price <= 600000) return Math.round(price * 0.135);
  if(price <= 750000) return Math.round(price * 0.14);
  if(price <= 950000) return Math.round(price * 0.145);
  if(price <= 1200000) return Math.round(price * 0.15);
  if(price <= 1600000) return Math.round(price * 0.16);
  if(price <= 2000000) return Math.round(price * 0.17);
  if(price <= 2500000) return Math.round(price * 0.18);
  return Math.round(price * 0.20);
}

// PERBAIKAN: Fungsi untuk menghitung profit dengan sistem 24 jam
function calculateClaimableProfit(investment, currentDate = new Date()) {
  const profitPerDay = investment.profit || getProfitPerDay(investment.price);
  const startDate = new Date(investment.start);
  const totalDays = investment.duration_days || 95;
  
  // Hitung jam yang sudah berlalu sejak pembelian
  const hoursPassed = getHoursDifference(investment.start, currentDate);
  
  // Setiap 24 jam = 1 hari profit
  const effectiveDaysPassed = Math.floor(hoursPassed / 24);
  const actualDaysPassed = Math.min(effectiveDaysPassed, totalDays);
  
  // Total profit yang seharusnya sudah terkumpul
  const totalAccumulatedProfit = actualDaysPassed * profitPerDay;
  const claimedProfit = investment.claimed_profit || 0;
  
  // Profit yang bisa di-claim
  const claimableProfit = totalAccumulatedProfit - claimedProfit;
  
  // Hitung jam menuju profit berikutnya
  const nextProfitHours = (actualDaysPassed + 1) * 24 - hoursPassed;
  const hasNextProfit = actualDaysPassed < totalDays;
  
  return {
    hoursPassed,
    daysPassed: actualDaysPassed,
    totalAccumulatedProfit,
    claimedProfit,
    claimableProfit: Math.max(0, claimableProfit),
    isCompleted: actualDaysPassed >= totalDays,
    profitPerDay,
    nextProfitHours: hasNextProfit ? nextProfitHours : 0,
    hasNextProfit
  };
}

// Format countdown timer
function formatCountdown(hours) {
  if (hours <= 0) return "Siap untuk di-claim!";
  
  const days = Math.floor(hours / 24);
  const remainingHours = hours % 24;
  
  if (days > 0) {
    return `${days} hari ${remainingHours} jam lagi`;
  } else {
    return `${remainingHours} jam lagi`;
  }
}

// Animasi Netflix untuk claim profit
function showNetflixAnimation(profitAmount) {
  const animation = document.createElement('div');
  animation.className = 'netflix-animation';
  animation.innerHTML = `
    <div class="profit-popup">
      <div class="netflix-logo">NETFLIX</div>
      <div class="profit-message">Profit Berhasil Diklaim!</div>
      <div class="profit-amount">+Rp ${formatRupiah(profitAmount)}</div>
      <div style="color: var(--light-gray); font-size: 16px;">Saldo Anda telah bertambah</div>
    </div>
  `;
  
  document.body.appendChild(animation);
  
  setTimeout(() => {
    animation.remove();
  }, 3000);
}

// Load produk user dengan sistem 24 jam
async function loadUserProducts() {
  try {
    const nohp = localStorage.getItem("nohp") || "831237885271";
    const userRef = ref(db, "users/" + nohp + "/investments");
    const snapshot = await get(userRef);
    
    const container = document.getElementById("productsContainer");
    container.innerHTML = "";
    
    if (!snapshot.exists()) {
      container.innerHTML = `
        <div class="empty-state fade-in">
          <div class="empty-icon">üì¶</div>
          <div class="empty-text">Belum ada produk yang dibeli</div>
          <div class="empty-subtext">Mulai investasi pertama Anda di halaman Invest</div>
        </div>
      `;
      return;
    }
    
    const investments = snapshot.val();
    const today = new Date();
    
    let hasProducts = false;
    
    for (const key in investments) {
      const investment = investments[key];
      hasProducts = true;
      
      // Gunakan fungsi calculateClaimableProfit dengan sistem 24 jam
      const profitData = calculateClaimableProfit(investment, today);
      
      const displayDaysPassed = profitData.daysPassed;
      const totalDays = investment.duration_days || 95;
      const remainingDays = Math.max(0, totalDays - displayDaysPassed);
      const progressPercent = Math.min(100, Math.round((displayDaysPassed / totalDays) * 100));
      
      // Tentukan status
      const isCompleted = displayDaysPassed >= totalDays;
      const status = isCompleted ? "Selesai" : "Aktif";
      const statusClass = isCompleted ? "status-completed" : "status-active";
      
      // Hitung profit terkumpul untuk display
      const displayTotalProfit = Math.min(displayDaysPassed * profitData.profitPerDay, totalDays * profitData.profitPerDay);
      const claimedProfit = investment.claimed_profit || 0;
      const unclaimedProfit = displayTotalProfit - claimedProfit;
      
      const canClaim = (unclaimedProfit > 0 && !isCompleted);
      
      const productCard = document.createElement("div");
      productCard.className = "product-card fade-in";
      productCard.setAttribute("data-status", isCompleted ? "completed" : "active");
      productCard.setAttribute("data-investment-id", key);
      
      // Tampilkan countdown jika belum ada profit yang bisa di-claim
      const countdownInfo = !canClaim && profitData.hasNextProfit ? 
        `<div class="countdown-timer">
           <div class="countdown-text">‚è∞ Profit berikutnya: ${formatCountdown(profitData.nextProfitHours)}</div>
         </div>` : '';
      
      productCard.innerHTML = `
        <div class="product-header">
          <div class="product-title">${investment.type || "Harian Basic"}</div>
          <div class="product-status ${statusClass}">${status}</div>
        </div>
        
        ${countdownInfo}
        
        <div class="product-details">
          <div class="detail-item">
            <span class="detail-label">Harga Produk</span>
            <span class="detail-value">Rp ${formatRupiah(investment.price)}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Profit/Hari</span>
            <span class="detail-value">Rp ${formatRupiah(profitData.profitPerDay)}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Tanggal Mulai</span>
            <span class="detail-value">${formatDate(investment.start)}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Durasi</span>
            <span class="detail-value">${totalDays} Hari</span>
          </div>
        </div>
        
        <div class="progress-section">
          <div class="progress-header">
            <span class="progress-label">Progress Kontrak</span>
            <span class="progress-percent">${progressPercent}%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: ${progressPercent}%"></div>
          </div>
        </div>
        
        <div class="product-details">
          <div class="detail-item">
            <span class="detail-label">Hari Berjalan</span>
            <span class="detail-value">${Math.min(displayDaysPassed, totalDays)}/${totalDays} Hari</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Sisa Hari</span>
            <span class="detail-value">${remainingDays} Hari</span>
          </div>
        </div>
        
        <div class="profit-summary">
          <div class="profit-item">
            <div class="profit-label">Profit Terkumpul</div>
            <div class="profit-value">Rp ${formatRupiah(displayTotalProfit)}</div>
          </div>
          <div class="profit-item">
            <div class="profit-label">Profit Di-claim</div>
            <div class="profit-value">Rp ${formatRupiah(claimedProfit)}</div>
          </div>
        </div>
        
        <div class="claim-section">
          <button class="claim-btn" 
                  onclick="claimProfit('${key}', ${unclaimedProfit})" 
                  ${!canClaim ? 'disabled' : ''}
                  id="claimBtn-${key}">
            ${canClaim ? `Claim Profit Rp ${formatRupiah(unclaimedProfit)}` : 
              claimedProfit > 0 ? 'Profit Telah Di-claim' : 'Menunggu Profit...'}
          </button>
        </div>
      `;
      
      container.appendChild(productCard);
    }
    
    if (!hasProducts) {
      container.innerHTML = `
        <div class="empty-state fade-in">
          <div class="empty-icon">üì¶</div>
          <div class="empty-text">Belum ada produk yang dibeli</div>
          <div class="empty-subtext">Mulai investasi pertama Anda di halaman Invest</div>
        </div>
      `;
    }
    
  } catch (error) {
    console.error("Error loading products:", error);
    document.getElementById("productsContainer").innerHTML = `
      <div class="empty-state fade-in">
        <div class="empty-icon">‚ùå</div>
        <div class="empty-text">Terjadi kesalahan</div>
        <div class="empty-subtext">Silakan coba lagi nanti</div>
      </div>
    `;
  }
}

// Claim profit function dengan sistem 24 jam
window.claimProfit = async function(investmentId, displayProfitAmount) {
  try {
    const nohp = localStorage.getItem("nohp") || "831237885271";
    const claimBtn = document.getElementById(`claimBtn-${investmentId}`);
    
    // Nonaktifkan tombol sementara untuk mencegah double click
    claimBtn.disabled = true;
    claimBtn.innerHTML = '<div class="loading-spinner"></div> Mengklaim...';
    
    // Ambil data user terbaru
    const userRef = ref(db, "users/" + nohp);
    const userSnapshot = await get(userRef);
    
    if (!userSnapshot.exists()) {
      throw new Error("Data user tidak ditemukan");
    }
    
    const userData = userSnapshot.val();
    const investment = userData.investments[investmentId];
    
    if (!investment) {
      throw new Error("Data investasi tidak ditemukan");
    }
    
    // Hitung profit yang bisa di-claim dengan sistem 24 jam
    const today = new Date();
    const profitData = calculateClaimableProfit(investment, today);
    
    const actualClaimAmount = profitData.claimableProfit;
    
    // Validasi profit
    if (actualClaimAmount <= 0) {
      throw new Error("Tidak ada profit yang bisa di-claim saat ini");
    }
    
    if (actualClaimAmount !== displayProfitAmount) {
      console.warn(`Profit mismatch: display=${displayProfitAmount}, actual=${actualClaimAmount}`);
    }
    
    // Update data di Firebase
    const updates = {};
    const newClaimedProfit = (investment.claimed_profit || 0) + actualClaimAmount;
    const newSaldo = (userData.saldo || 0) + actualClaimAmount;
    
    updates[`users/${nohp}/saldo`] = newSaldo;
    updates[`users/${nohp}/investments/${investmentId}/claimed_profit`] = newClaimedProfit;
    updates[`users/${nohp}/investments/${investmentId}/last_claim_date`] = new Date().toISOString();
    updates[`users/${nohp}/total_profit`] = (userData.total_profit || 0) + actualClaimAmount;
    
    await update(ref(db), updates);
    
    console.log(`Claim profit berhasil: Rp ${formatRupiah(actualClaimAmount)}`);
    
    // Tampilkan animasi Netflix
    showNetflixAnimation(actualClaimAmount);
    
    // Update UI setelah sukses
    setTimeout(() => {
      claimBtn.textContent = 'Profit Telah Di-claim';
      claimBtn.classList.add('claimed');
      claimBtn.disabled = true;
      
      // Refresh data setelah 3 detik
      setTimeout(() => {
        loadUserProducts();
      }, 3000);
    }, 1000);
    
  } catch (error) {
    console.error("Error claiming profit:", error);
    
    // Reset tombol
    const claimBtn = document.getElementById(`claimBtn-${investmentId}`);
    if (claimBtn) {
      claimBtn.disabled = false;
      claimBtn.textContent = `Claim Profit Rp ${formatRupiah(displayProfitAmount)}`;
    }
    
    alert("Gagal mengklaim profit: " + error.message);
  }
}

// Filter produk
window.filterProducts = function(filter) {
  // Update active tab
  document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
  event.target.classList.add('active');
  
  const products = document.querySelectorAll('.product-card');
  let hasVisibleProducts = false;
  
  products.forEach(product => {
    if (filter === 'all') {
      product.style.display = 'block';
      hasVisibleProducts = true;
    } else {
      const status = product.getAttribute('data-status');
      if (status === filter) {
        product.style.display = 'block';
        hasVisibleProducts = true;
      } else {
        product.style.display = 'none';
      }
    }
  });
  
  // Tampilkan pesan jika tidak ada produk yang visible
  const container = document.getElementById("productsContainer");
  const existingEmptyMessage = container.querySelector('.empty-state');
  if (existingEmptyMessage) {
    existingEmptyMessage.remove();
  }
  
  if (!hasVisibleProducts && products.length > 0) {
    const emptyFilter = document.createElement("div");
    emptyFilter.className = "empty-state fade-in";
    emptyFilter.innerHTML = `
      <div class="empty-icon">üîç</div>
      <div class="empty-text">Tidak ada produk ${filter === 'active' ? 'aktif' : 'selesai'}</div>
      <div class="empty-subtext">Coba lihat di tab lainnya</div>
    `;
    container.appendChild(emptyFilter);
  }
}

// Initialize
loadUserProducts();

// Auto refresh setiap 1 menit untuk update countdown
setInterval(() => {
  loadUserProducts();
}, 60000);
</script>

</body>
</html>