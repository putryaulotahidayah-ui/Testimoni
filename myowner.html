 
<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel | Netflix Invest</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
  --primary: #e50914; --primary-dark: #b20710; --secondary: #6f42c1; --secondary-dark: #59359c;
  --success: #28a745; --success-dark: #1f7a34; --warning: #ffc107; --warning-dark: #e0a800;
  --danger: #dc3545; --danger-dark: #c82333; --info: #17a2b8; --info-dark: #138496;
  --dark: #0d0d0d; --dark-light: #1c1c1c; --darker: #252525; --light: #f8f9fa;
  --gray: #aaa; --gray-dark: #555; --border: #333;
  --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
  --shadow: 0 8px 30px rgba(0,0,0,0.7); --shadow-light: 0 4px 15px rgba(0,0,0,0.5);
  --radius: 12px; --radius-sm: 8px; --transition: all 0.3s ease;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Poppins', Arial, sans-serif; background: var(--dark); color: var(--light); line-height: 1.6; overflow-x: hidden; }

.login-container { max-width: 450px; margin: 80px auto; padding: 40px 30px; background: var(--dark-light); border-radius: var(--radius); box-shadow: var(--shadow); text-align: center; animation: fadeIn 0.5s ease; }
.login-container h2 { margin-bottom: 10px; color: var(--primary); font-size: 1.8rem; }
.login-container p { color: var(--gray); margin-bottom: 30px; }
.login-container input { width: 100%; padding: 15px 20px; margin-bottom: 20px; border-radius: var(--radius); border: 1px solid var(--border); background: var(--dark); color: var(--light); font-size: 1rem; transition: var(--transition); }
.login-container input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 2px rgba(229, 9, 20, 0.2); }
.login-container button { width: 100%; padding: 15px; background: var(--primary); color: #fff; border: none; border-radius: var(--radius); font-weight: 600; cursor: pointer; transition: var(--transition); font-size: 1rem; margin-top: 10px; }
.login-container button:hover { background: var(--primary-dark); transform: translateY(-2px); }
.error-message { color: var(--danger); text-align: center; margin-top: 15px; display: none; font-size: 0.9rem; }

.admin-container { display: flex; min-height: 100vh; }
.sidebar { width: 260px; background: var(--dark-light); padding: 20px 0; box-shadow: var(--shadow); transition: var(--transition); z-index: 100; position: fixed; height: 100vh; overflow-y: auto; }
.sidebar.collapsed { width: 80px; }
.sidebar-header { padding: 0 20px 20px; border-bottom: 1px solid var(--border); margin-bottom: 20px; }
.sidebar-header h2 { color: var(--primary); display: flex; align-items: center; gap: 10px; font-size: 1.4rem; }
.sidebar.collapsed .sidebar-header h2 span { display: none; }
.sidebar-menu { list-style: none; padding: 0 10px; }
.sidebar-menu li { margin-bottom: 5px; }
.sidebar-menu a { display: flex; align-items: center; padding: 12px 15px; color: var(--gray); text-decoration: none; border-radius: var(--radius); transition: var(--transition); gap: 12px; }
.sidebar-menu a:hover, .sidebar-menu a.active { background: rgba(229, 9, 20, 0.1); color: var(--primary); }
.sidebar-menu i { font-size: 1.2rem; width: 24px; text-align: center; }
.sidebar.collapsed .sidebar-menu span { display: none; }
.sidebar.collapsed .sidebar-menu a { justify-content: center; padding: 12px; }

.main-content { flex: 1; padding: 20px; margin-left: 260px; transition: var(--transition); }
.main-content.expanded { margin-left: 80px; }
.header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 15px; border-bottom: 1px solid var(--border); }
.header h1 { color: var(--light); font-size: 1.8rem; font-weight: 600; }
.user-actions { display: flex; gap: 15px; align-items: center; }
.toggle-sidebar, .theme-toggle, .hamburger-menu { background: var(--dark-light); border: none; color: var(--light); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: var(--transition); }
.toggle-sidebar:hover, .theme-toggle:hover, .hamburger-menu:hover { background: var(--darker); transform: translateY(-2px); }
.user-info { display: flex; align-items: center; gap: 10px; background: var(--dark-light); padding: 8px 15px; border-radius: 30px; cursor: pointer; transition: var(--transition); position: relative; }
.user-info:hover { background: var(--darker); }
.user-avatar { width: 36px; height: 36px; border-radius: 50%; background: var(--gradient); display: flex; align-items: center; justify-content: center; font-weight: bold; }

.dropdown-menu { position: absolute; top: 100%; right: 0; background: var(--dark-light); border-radius: var(--radius); box-shadow: var(--shadow); width: 280px; padding: 15px 0; margin-top: 10px; display: none; z-index: 1000; }
.dropdown-menu.show { display: block; animation: fadeIn 0.3s ease; }
.dropdown-menu h3 { padding: 0 20px 10px; color: var(--warning); font-size: 1.1rem; border-bottom: 1px solid var(--border); margin-bottom: 10px; }
.dropdown-menu a { display: flex; align-items: center; padding: 12px 20px; color: var(--gray); text-decoration: none; transition: var(--transition); gap: 12px; }
.dropdown-menu a:hover { background: rgba(229, 9, 20, 0.1); color: var(--primary); }
.dropdown-menu a i { width: 20px; text-align: center; }

.stats-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
.stat-card { background: var(--dark-light); padding: 20px; border-radius: var(--radius); box-shadow: var(--shadow-light); transition: var(--transition); display: flex; align-items: center; gap: 15px; position: relative; overflow: hidden; }
.stat-card::before { content: ''; position: absolute; top: 0; left: 0; width: 5px; height: 100%; }
.stat-card.deposit::before { background: var(--success); }
.stat-card.withdraw::before { background: var(--warning); }
.stat-card.users::before { background: var(--info); }
.stat-card.revenue::before { background: var(--secondary); }
.stat-card:hover { transform: translateY(-5px); box-shadow: var(--shadow); }
.stat-icon { width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
.stat-card.deposit .stat-icon { background: rgba(40, 167, 69, 0.2); color: var(--success); }
.stat-card.withdraw .stat-icon { background: rgba(255, 193, 7, 0.2); color: var(--warning); }
.stat-card.users .stat-icon { background: rgba(23, 162, 184, 0.2); color: var(--info); }
.stat-card.revenue .stat-icon { background: rgba(111, 66, 193, 0.2); color: var(--secondary); }
.stat-info h3 { font-size: 1.8rem; margin-bottom: 5px; }
.stat-info p { color: var(--gray); font-size: 0.9rem; }

.card { background: var(--dark-light); padding: 20px; border-radius: var(--radius); margin-bottom: 25px; box-shadow: var(--shadow-light); transition: var(--transition); }
.card:hover { box-shadow: var(--shadow); }
.card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border); }
.card-header h3 { font-size: 1.3rem; font-weight: 600; display: flex; align-items: center; gap: 10px; }
.card-actions { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
.search-box { position: relative; width: 250px; max-width: 100%; }
.search-box input { width: 100%; padding: 10px 15px 10px 40px; border-radius: 30px; border: 1px solid var(--border); background: var(--dark); color: var(--light); font-size: 0.9rem; transition: var(--transition); }
.search-box input:focus { border-color: var(--primary); box-shadow: 0 0 0 2px rgba(229, 9, 20, 0.2); outline: none; }
.search-box i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--gray); }
.filter-btn, .export-btn { background: var(--dark); border: 1px solid var(--border); color: var(--light); padding: 10px 15px; border-radius: 30px; cursor: pointer; transition: var(--transition); display: flex; align-items: center; gap: 8px; font-size: 0.9rem; }
.filter-btn:hover, .export-btn:hover { background: var(--darker); }

.table-container { overflow-x: auto; border-radius: var(--radius); }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid var(--border); font-size: 0.9rem; }
th { color: var(--warning); font-weight: 600; position: sticky; top: 0; background: var(--dark-light); }
tr { transition: var(--transition); }
tr:hover { background: rgba(255, 255, 255, 0.05); }
.status { display: inline-block; padding: 5px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }
.status.pending { background: rgba(255, 193, 7, 0.2); color: var(--warning); }
.status.success { background: rgba(40, 167, 69, 0.2); color: var(--success); }
.status.failed { background: rgba(229, 9, 20, 0.2); color: var(--danger); }

.btn { padding: 8px 15px; border: none; border-radius: var(--radius-sm); font-weight: 600; cursor: pointer; transition: var(--transition); display: inline-flex; align-items: center; gap: 5px; font-size: 0.9rem; }
.btn-sm { padding: 6px 12px; font-size: 0.8rem; }
.btn-success { background: var(--success); color: #fff; }
.btn-success:hover { background: var(--success-dark); transform: translateY(-2px); }
.btn-danger { background: var(--danger); color: #fff; }
.btn-danger:hover { background: var(--danger-dark); transform: translateY(-2px); }
.btn-warning { background: var(--warning); color: #212529; }
.btn-warning:hover { background: var(--warning-dark); transform: translateY(-2px); }
.btn-secondary { background: transparent; border: 1px solid var(--border); color: var(--light); }
.btn-secondary:hover { background: var(--darker); }
.btn-primary { background: var(--primary); color: #fff; }
.btn-primary:hover { background: var(--primary-dark); transform: translateY(-2px); }
.btn-info { background: var(--info); color: #fff; }
.btn-info:hover { background: var(--info-dark); transform: translateY(-2px); }

#toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: var(--success); color: #fff; padding: 15px 25px; border-radius: var(--radius); display: none; box-shadow: var(--shadow); z-index: 1000; font-weight: 500; }
#loader { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); justify-content: center; align-items: center; z-index: 999; }
#loader div { border: 5px solid #fff; border-top: 5px solid var(--primary); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }

@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

.section { display: none; animation: fadeIn 0.5s ease; }
.section.active { display: block; }

.mobile-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 99; }

@media (max-width: 992px) {
  .sidebar { width: 280px; transform: translateX(-100%); z-index: 100; }
  .sidebar.mobile-open { transform: translateX(0); }
  .main-content { margin-left: 0; width: 100%; }
  .stats-container { grid-template-columns: repeat(2, 1fr); }
  .hamburger-menu { display: flex; }
  .toggle-sidebar { display: none; }
  .mobile-overlay.active { display: block; }
  .table-container { font-size: 0.8rem; }
  th, td { padding: 8px 10px; }
}

@media (max-width: 768px) {
  .stats-container { grid-template-columns: 1fr; }
  .card-header { flex-direction: column; align-items: flex-start; gap: 15px; }
  .card-actions { width: 100%; justify-content: space-between; }
  .search-box { width: 100%; }
  table { font-size: 0.8rem; }
  th, td { padding: 8px 10px; }
  .btn-sm { padding: 4px 8px; font-size: 0.7rem; }
  .search-box { order: 1; width: 100%; margin-bottom: 10px; }
  .card-actions { flex-direction: column; align-items: flex-start; }
  .filter-btn, .export-btn, .btn-success { margin-top: 5px; }
}

@media (max-width: 576px) {
  .main-content { padding: 10px; }
  .header { flex-direction: column; gap: 15px; align-items: flex-start; }
  .user-actions { width: 100%; justify-content: space-between; }
  .card { padding: 15px; }
  .table-container { font-size: 0.75rem; }
  th, td { padding: 6px 8px; }
  .login-container { margin: 40px 20px; padding: 30px 20px; }
}

body.light-theme {
  --dark: #f8f9fa; --dark-light: #ffffff; --darker: #e9ecef; --light: #212529;
  --gray: #6c757d; --gray-dark: #495057; --border: #dee2e6;
  --shadow: 0 8px 30px rgba(0,0,0,0.1); --shadow-light: 0 4px 15px rgba(0,0,0,0.05);
}
body.light-theme .card, body.light-theme .sidebar, body.light-theme .stat-card,
body.light-theme .dropdown-menu, body.light-theme .toggle-sidebar,
body.light-theme .theme-toggle, body.light-theme .hamburger-menu,
body.light-theme .user-info, body.light-theme .filter-btn,
body.light-theme .export-btn, body.light-theme .search-box input {
  background: var(--dark-light); color: var(--light); border-color: var(--border);
}
body.light-theme .search-box input { background: var(--darker); }
body.light-theme th { background: var(--dark-light); }
body.light-theme .login-container { background: var(--dark-light); color: var(--light); }
body.light-theme .login-container input { background: var(--darker); color: var(--light); border-color: var(--border); }

.mobile-menu-header { display: none; padding: 15px 20px; border-bottom: 1px solid var(--border); justify-content: space-between; align-items: center; }
.mobile-menu-header h2 { color: var(--primary); font-size: 1.2rem; }
.close-menu { background: none; border: none; color: var(--light); font-size: 1.5rem; cursor: pointer; }
@media (max-width: 992px) { .mobile-menu-header { display: flex; } }

.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1100; justify-content: center; align-items: center; }
.modal-content { background: var(--dark-light); border-radius: var(--radius); box-shadow: var(--shadow); width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto; animation: fadeIn 0.3s ease; }
.modal-header { display: flex; justify-content: space-between; align-items: center; padding: 20px; border-bottom: 1px solid var(--border); }
.modal-header h3 { font-size: 1.3rem; color: var(--primary); }
.close-modal { background: none; border: none; color: var(--light); font-size: 1.5rem; cursor: pointer; transition: var(--transition); }
.close-modal:hover { color: var(--primary); }
.modal-body { padding: 20px; }
.form-group { margin-bottom: 20px; }
.form-group label { display: block; margin-bottom: 8px; color: var(--gray); font-weight: 500; }
.form-group input, .form-group select, .form-group textarea {
  width: 100%; padding: 12px 15px; border-radius: var(--radius-sm); border: 1px solid var(--border);
  background: var(--dark); color: var(--light); font-size: 1rem; transition: var(--transition);
}
.form-group input:focus, .form-group select:focus, .form-group textarea:focus {
  border-color: var(--primary); outline: none; box-shadow: 0 0 0 2px rgba(229, 9, 20, 0.2);
}
.form-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }

.action-buttons { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; }
.action-buttons .btn { margin: 2px; }

.password-field { display: flex; align-items: center; }
.password-field input { flex: 1; border-top-right-radius: 0; border-bottom-right-radius: 0; }
.toggle-password { background: var(--dark); border: 1px solid var(--border); border-left: none; border-top-right-radius: var(--radius-sm); border-bottom-right-radius: var(--radius-sm); padding: 0 12px; height: 46px; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--gray); }
.toggle-password:hover { background: var(--darker); }

.dashboard-menu { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
.dashboard-card { background: var(--dark-light); border-radius: var(--radius); padding: 25px; text-align: center; box-shadow: var(--shadow-light); transition: var(--transition); cursor: pointer; border: 1px solid transparent; }
.dashboard-card:hover { transform: translateY(-5px); box-shadow: var(--shadow); border-color: var(--primary); }
.dashboard-card i { font-size: 2.5rem; margin-bottom: 15px; color: var(--primary); }
.dashboard-card h3 { font-size: 1.3rem; margin-bottom: 10px; color: var(--light); }
.dashboard-card p { color: var(--gray); font-size: 0.9rem; }

.enhanced-table { width: 100%; border-collapse: collapse; }
.enhanced-table th { background: var(--dark); color: var(--warning); font-weight: 600; padding: 15px; text-align: left; border-bottom: 2px solid var(--border); }
.enhanced-table td { padding: 15px; border-bottom: 1px solid var(--border); vertical-align: middle; }
.enhanced-table tr:hover { background: rgba(255, 255, 255, 0.05); }

.products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
.product-card { background: var(--dark); border-radius: var(--radius); overflow: hidden; box-shadow: var(--shadow-light); transition: var(--transition); border: 1px solid rgba(255, 255, 255, 0.05); }
.product-card:hover { transform: translateY(-5px); box-shadow: var(--shadow); }
.product-header { padding: 15px; background: var(--primary); color: white; text-align: center; }
.product-body { padding: 20px; }
.product-price { font-size: 1.5rem; font-weight: 700; color: var(--success); margin: 10px 0; }
.product-features { list-style: none; margin: 15px 0; }
.product-features li { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; color: var(--gray); }
.product-features i { color: var(--success); }
.product-actions { display: flex; gap: 10px; margin-top: 20px; }
.product-actions .btn { flex: 1; justify-content: center; }

.active-members-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
.member-card { background: var(--dark); border-radius: var(--radius); padding: 20px; text-align: center; box-shadow: var(--shadow-light); transition: var(--transition); border: 1px solid rgba(255, 255, 255, 0.05); }
.member-card:hover { transform: translateY(-5px); box-shadow: var(--shadow); }
.member-avatar { width: 80px; height: 80px; border-radius: 50%; background: var(--gradient); display: flex; align-items: center; justify-content: center; font-size: 1.8rem; font-weight: bold; margin: 0 auto 15px; color: white; }
.member-name { font-size: 1.2rem; font-weight: 600; margin-bottom: 5px; }
.member-email { color: var(--gray); margin-bottom: 15px; }
.member-stats { display: flex; justify-content: space-between; margin-top: 15px; }
.stat-item { text-align: center; }
.stat-value { font-size: 1.2rem; font-weight: 700; color: var(--success); }
.stat-label { font-size: 0.8rem; color: var(--gray); }

.actions-center { display: flex; justify-content: center; align-items: center; flex-wrap: wrap; gap: 5px; }
.actions-center .btn { margin: 2px; }
</style>
</head>
<body>

<div id="loginForm" class="login-container">
  <h2><i class="fas fa-film"></i> Netflix Invest</h2>
  <p>Admin Panel - Masuk ke Akun Anda</p>
  <input type="text" id="username" placeholder="Username" autocomplete="off">
  <input type="password" id="password" placeholder="Password" autocomplete="off">
  <button id="loginBtn"><i class="fas fa-sign-in-alt"></i> Login</button>
  <div id="loginError" class="error-message"><i class="fas fa-exclamation-circle"></i> Username atau password salah!</div>
</div>

<div id="adminPanel" style="display:none;">
  <div class="admin-container">
    <div class="mobile-overlay" id="mobileOverlay"></div>
    
    <div class="sidebar" id="sidebar">
      <div class="mobile-menu-header">
        <h2>Netflix Invest</h2>
        <button class="close-menu" id="closeMenu"><i class="fas fa-times"></i></button>
      </div>
      <div class="sidebar-header">
        <h2><i class="fas fa-film"></i> <span>Netflix Invest</span></h2>
      </div>
      <ul class="sidebar-menu">
        <li><a href="#" class="menu-item active" data-target="dashboard"><i class="fas fa-home"></i> <span>Dashboard</span></a></li>
        <li><a href="#" class="menu-item" data-target="deposit"><i class="fas fa-wallet"></i> <span>Deposit</span></a></li>
        <li><a href="#" class="menu-item" data-target="withdraw"><i class="fas fa-money-bill-wave"></i> <span>Penarikan</span></a></li>
        <li><a href="#" class="menu-item" data-target="users"><i class="fas fa-users"></i> <span>Semua User</span></a></li>
        <li><a href="#" class="menu-item" data-target="active-members"><i class="fas fa-user-check"></i> <span>Anggota Aktif</span></a></li>
        <li><a href="#" class="menu-item" data-target="products"><i class="fas fa-box"></i> <span>Produk</span></a></li>
        <li><a href="#" class="menu-item" data-target="settings"><i class="fas fa-cog"></i> <span>Pengaturan</span></a></li>
      </ul>
    </div>

    <div class="main-content" id="mainContent">
      <div class="header">
        <h1 id="pageTitle">Admin Dashboard</h1>
        <div class="user-actions">
          <button class="hamburger-menu" id="hamburgerMenu"><i class="fas fa-bars"></i></button>
          <button class="theme-toggle" id="themeToggle"><i class="fas fa-moon"></i></button>
          <button class="toggle-sidebar" id="toggleSidebar"><i class="fas fa-bars"></i></button>
          <div class="user-info" id="userMenuBtn">
            <div class="user-avatar">A</div>
            <span>Admin</span>
            <div class="dropdown-menu" id="userDropdown">
              <h3>Admin Menu</h3>
              <a href="#" id="profileBtn"><i class="fas fa-user"></i> Profil Saya</a>
              <a href="#" id="changePasswordBtn"><i class="fas fa-key"></i> Ganti Password</a>
              <a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
          </div>
        </div>
      </div>

      <section id="dashboard" class="section active">
        <div class="stats-container">
          <div class="stat-card deposit">
            <div class="stat-icon"><i class="fas fa-wallet"></i></div>
            <div class="stat-info">
              <h3 id="totalDeposit">0</h3>
              <p>Deposit Pending</p>
            </div>
          </div>
          <div class="stat-card withdraw">
            <div class="stat-icon"><i class="fas fa-money-bill-wave"></i></div>
            <div class="stat-info">
              <h3 id="totalWithdraw">0</h3>
              <p>Penarikan Pending</p>
            </div>
          </div>
          <div class="stat-card users">
            <div class="stat-icon"><i class="fas fa-users"></i></div>
            <div class="stat-info">
              <h3 id="totalUsers">0</h3>
              <p>Total Users</p>
            </div>
          </div>
          <div class="stat-card revenue">
            <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
            <div class="stat-info">
              <h3 id="totalRevenue">0</h3>
              <p>Total Revenue</p>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3><i class="fas fa-tachometer-alt"></i> Menu Cepat</h3>
          </div>
          <div class="dashboard-menu">
            <div class="dashboard-card" data-target="deposit">
              <i class="fas fa-wallet"></i>
              <h3>Kelola Deposit</h3>
              <p>Acc/Tolak deposit pending dari user</p>
            </div>
            <div class="dashboard-card" data-target="withdraw">
              <i class="fas fa-money-bill-wave"></i>
              <h3>Kelola Penarikan</h3>
              <p>Acc/Tolak penarikan pending dari user</p>
            </div>
            <div class="dashboard-card" data-target="users">
              <i class="fas fa-users"></i>
              <h3>Semua User</h3>
              <p>Kelola semua data user dan saldo</p>
            </div>
            <div class="dashboard-card" data-target="products">
              <i class="fas fa-box"></i>
              <h3>Produk Investasi</h3>
              <p>Tambah, edit, dan hapus produk</p>
            </div>
            <div class="dashboard-card" data-target="settings">
              <i class="fas fa-cog"></i>
              <h3>Pengaturan</h3>
              <p>Atur sistem dan komisi</p>
            </div>
          </div>
        </div>
      </section>

      <section id="deposit" class="section">
        <div class="card">
          <div class="card-header">
            <h3><i class="fas fa-wallet"></i> Deposit Pending</h3>
            <div class="card-actions">
              <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchDeposit" placeholder="Cari user...">
              </div>
              <button class="filter-btn"><i class="fas fa-filter"></i> Filter</button>
              <button class="export-btn"><i class="fas fa-download"></i> Export</button>
            </div>
          </div>
          <div class="table-container">
            <table class="enhanced-table deposit-table">
              <thead>
                <tr>
                  <th>User</th>
                  <th>Nominal</th>
                  <th>Tanggal</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody id="depositTableBody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <section id="withdraw" class="section">
        <div class="card">
          <div class="card-header">
            <h3><i class="fas fa-money-bill-wave"></i> Penarikan Pending</h3>
            <div class="card-actions">
              <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchWithdraw" placeholder="Cari user...">
              </div>
              <button class="filter-btn"><i class="fas fa-filter"></i> Filter</button>
              <button class="export-btn"><i class="fas fa-download"></i> Export</button>
            </div>
          </div>
          <div class="table-container">
            <table class="enhanced-table withdraw-table">
              <thead>
                <tr>
                  <th>User</th>
                  <th>Jumlah</th>
                  <th>No. Rekening</th>
                  <th>Tanggal</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody id="withdrawTableBody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <section id="users" class="section">
        <div class="card">
          <div class="card-header">
            <h3><i class="fas fa-users"></i> Semua Pengguna</h3>
            <div class="card-actions">
              <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchUsers" placeholder="Cari user...">
              </div>
              <button class="filter-btn"><i class="fas fa-filter"></i> Filter</button>
              <button class="export-btn"><i class="fas fa-download"></i> Export</button>
              <button class="btn btn-success" id="addUserBtn"><i class="fas fa-plus"></i> Tambah User</button>
            </div>
          </div>
          <div class="table-container">
            <table class="enhanced-table users-table">
              <thead>
                <tr>
                  <th>Username</th>
                  <th>No. HP</th>
                  <th>Email</th>
                  <th>Saldo</th>
                  <th>Password</th>
                  <th>Bergabung</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody id="usersTableBody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <section id="active-members" class="section">
        <div class="card">
          <div class="card-header">
            <h3><i class="fas fa-user-check"></i> Anggota Aktif</h3>
            <div class="card-actions">
              <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchActiveMembers" placeholder="Cari user...">
              </div>
              <button class="filter-btn"><i class="fas fa-filter"></i> Filter</button>
              <button class="export-btn"><i class="fas fa-download"></i> Export</button>
            </div>
          </div>
          <div id="activeMembersContainer" class="active-members-grid"></div>
        </div>
      </section>

      <section id="products" class="section">
        <div class="card">
          <div class="card-header">
            <h3><i class="fas fa-box"></i> Produk Investasi</h3>
            <div class="card-actions">
              <button class="btn btn-success" id="addProductBtn"><i class="fas fa-plus"></i> Tambah Produk</button>
            </div>
          </div>
          <div id="productsContainer" class="products-grid"></div>
        </div>
      </section>

      <section id="settings" class="section">
        <div class="card">
          <div class="card-header">
            <h3><i class="fas fa-cog"></i> Pengaturan Sistem</h3>
          </div>
          <div class="form-group">
            <label for="appName">Nama Aplikasi</label>
            <input type="text" id="appName" value="Netflix Invest">
          </div>
          <div class="form-group">
            <label for="adminEmail">Email Admin</label>
            <input type="email" id="adminEmail" value="admin@netflixinvest.com">
          </div>
          <div class="form-group">
            <label for="withdrawalFee">Biaya Penarikan (%)</label>
            <input type="number" id="withdrawalFee" value="10" min="0" max="100">
          </div>
          <div class="form-group">
            <label for="minDeposit">Minimal Deposit</label>
            <input type="number" id="minDeposit" value="10000" min="0">
          </div>
          <div class="form-group">
            <label for="referralLevel1">Komisi Level 1 (%)</label>
            <input type="number" id="referralLevel1" value="20" min="0" max="100">
          </div>
          <div class="form-group">
            <label for="referralLevel2">Komisi Level 2 (%)</label>
            <input type="number" id="referralLevel2" value="2" min="0" max="100">
          </div>
          <div class="form-group">
            <label for="referralLevel3">Komisi Level 3 (%)</label>
            <input type="number" id="referralLevel3" value="1" min="0" max="100">
          </div>
          <div class="form-actions">
            <button class="btn btn-secondary">Batal</button>
            <button class="btn btn-success">Simpan Pengaturan</button>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>

<div id="addProductModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Tambah Produk Baru</h3>
      <button class="close-modal">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label for="productName">Nama Produk</label>
        <input type="text" id="productName" placeholder="Contoh: Netflix Basic">
      </div>
      <div class="form-group">
        <label for="productPrice">Harga (Rp)</label>
        <input type="number" id="productPrice" placeholder="Contoh: 50000">
      </div>
      <div class="form-group">
        <label for="productProfit">Keuntungan (%)</label>
        <input type="number" id="productProfit" placeholder="Contoh: 10">
      </div>
      <div class="form-group">
        <label for="productDuration">Durasi (hari)</label>
        <input type="number" id="productDuration" placeholder="Contoh: 30">
      </div>
      <div class="form-group">
        <label for="productDescription">Deskripsi</label>
        <textarea id="productDescription" rows="3" placeholder="Deskripsi produk"></textarea>
      </div>
      <div class="form-actions">
        <button class="btn btn-secondary" id="cancelProductBtn">Batal</button>
        <button class="btn btn-success" id="saveProductBtn">Simpan Produk</button>
      </div>
    </div>
  </div>
</div>

<div id="addUserModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Tambah User Baru</h3>
      <button class="close-modal">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label for="newUsername">Username</label>
        <input type="text" id="newUsername" placeholder="Contoh: user123">
      </div>
      <div class="form-group">
        <label for="newNohp">No. HP</label>
        <input type="text" id="newNohp" placeholder="Contoh: 08123456789">
      </div>
      <div class="form-group">
        <label for="newPassword">Password</label>
        <input type="password" id="newPassword" placeholder="Password minimal 6 karakter">
      </div>
      <div class="form-group">
        <label for="newEmail">Email</label>
        <input type="email" id="newEmail" placeholder="Contoh: user@example.com">
      </div>
      <div class="form-group">
        <label for="initialBalance">Saldo Awal</label>
        <input type="number" id="initialBalance" value="0" min="0">
      </div>
      <div class="form-actions">
        <button class="btn btn-secondary" id="cancelUserBtn">Batal</button>
        <button class="btn btn-success" id="saveUserBtn">Simpan User</button>
      </div>
    </div>
  </div>
</div>

<div id="editUserModal" class="modal">
  <div class="modal-content edit-user-modal">
    <div class="modal-header">
      <h3>Edit Data User</h3>
      <button class="close-modal">&times;</button>
    </div>
    <div class="modal-body">
      <div class="edit-user-form">
        <div class="form-group">
          <label for="editUsername">Username</label>
          <input type="text" id="editUsername" readonly>
        </div>
        <div class="form-group">
          <label for="editNohp">No. HP</label>
          <input type="text" id="editNohp" placeholder="No. HP">
        </div>
        <div class="form-group">
          <label for="editEmail">Email</label>
          <input type="email" id="editEmail" placeholder="Email">
        </div>
        <div class="form-group">
          <label for="editPassword">Password</label>
          <div class="password-field">
            <input type="password" id="editPassword" placeholder="Password">
            <button class="toggle-password" type="button"><i class="fas fa-eye"></i></button>
          </div>
        </div>
        <div class="form-group">
          <label for="editSaldo">Saldo</label>
          <input type="number" id="editSaldo" placeholder="Saldo">
        </div>
        <div class="form-group full-width">
          <label for="editReferralCode">Kode Referral</label>
          <input type="text" id="editReferralCode" placeholder="Kode Referral">
        </div>
        <div class="form-group full-width">
          <label for="editUpline">Upline</label>
          <input type="text" id="editUpline" placeholder="Username Upline">
        </div>
      </div>
      <div class="form-actions">
        <button class="btn btn-secondary" id="cancelEditUserBtn">Batal</button>
        <button class="btn btn-success" id="saveEditUserBtn">Simpan Perubahan</button>
      </div>
    </div>
  </div>
</div>

<div id="deleteUserModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Hapus Akun User</h3>
      <button class="close-modal">&times;</button>
    </div>
    <div class="modal-body">
      <p id="deleteUserMessage">Apakah Anda yakin ingin menghapus akun ini? Semua data termasuk saldo, produk, dan riwayat transaksi akan dihapus permanen.</p>
      <div class="form-actions">
        <button class="btn btn-secondary" id="cancelDeleteUserBtn">Batal</button>
        <button class="btn btn-danger" id="confirmDeleteUserBtn">Ya, Hapus Akun</button>
      </div>
    </div>
  </div>
</div>

<div id="toast"></div>
<div id="loader"><div></div></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, get, update, set, remove, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAuJSxpcFZ1QI-dEsEnx2qSqlb0wsvs6Mc",
  authDomain: "lginvest-776cf.firebaseapp.com",
  databaseURL: "https://lginvest-776cf-default-rtdb.firebaseio.com",
  projectId: "lginvest-776cf",
  storageBucket: "lginvest-776cf.appspot.com",
  messagingSenderId: "831934282072",
  appId: "1:831934282072:web:6a8b7a5bcba5d4d1264d2d",
  measurementId: "G-265YF9DYCF"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const ADMIN_CREDENTIALS = { username: "@Subang", password: "120506" };

const loginForm = document.getElementById("loginForm");
const adminPanel = document.getElementById("adminPanel");
const usernameInput = document.getElementById("username");
const passwordInput = document.getElementById("password");
const loginBtn = document.getElementById("loginBtn");
const loginError = document.getElementById("loginError");
const loaderEl = document.getElementById("loader");
const toastEl = document.getElementById("toast");
const sidebar = document.getElementById("sidebar");
const mainContent = document.getElementById("mainContent");
const toggleSidebar = document.getElementById("toggleSidebar");
const themeToggle = document.getElementById("themeToggle");
const hamburgerMenu = document.getElementById("hamburgerMenu");
const userMenuBtn = document.getElementById("userMenuBtn");
const userDropdown = document.getElementById("userDropdown");
const logoutBtn = document.getElementById("logoutBtn");
const closeMenu = document.getElementById("closeMenu");
const mobileOverlay = document.getElementById("mobileOverlay");
const addProductBtn = document.getElementById("addProductBtn");
const addProductModal = document.getElementById("addProductModal");
const cancelProductBtn = document.getElementById("cancelProductBtn");
const saveProductBtn = document.getElementById("saveProductBtn");
const addUserBtn = document.getElementById("addUserBtn");
const addUserModal = document.getElementById("addUserModal");
const cancelUserBtn = document.getElementById("cancelUserBtn");
const saveUserBtn = document.getElementById("saveUserBtn");
const closeModalBtns = document.querySelectorAll(".close-modal");
const editUserModal = document.getElementById("editUserModal");
const cancelEditUserBtn = document.getElementById("cancelEditUserBtn");
const saveEditUserBtn = document.getElementById("saveEditUserBtn");
const deleteUserModal = document.getElementById("deleteUserModal");
const cancelDeleteUserBtn = document.getElementById("cancelDeleteUserBtn");
const confirmDeleteUserBtn = document.getElementById("confirmDeleteUserBtn");

let currentUserKey = null;
let usersData = {};
let productsData = {};

function showToast(msg, color = "var(--success)") {
  toastEl.textContent = msg;
  toastEl.style.background = color;
  toastEl.style.display = "block";
  setTimeout(() => { toastEl.style.display = "none"; }, 3000);
}

function checkLogin() {
  const loggedIn = sessionStorage.getItem('adminLoggedIn');
  if (loggedIn === 'true') {
    loginForm.style.display = 'none';
    adminPanel.style.display = 'block';
    initializeAdminPanel();
  }
}

function initializeAdminPanel() {
  if (toggleSidebar) {
    toggleSidebar.addEventListener('click', () => {
      sidebar.classList.toggle('collapsed');
      mainContent.classList.toggle('expanded');
    });
  }

  if (themeToggle) {
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('light-theme');
      if (document.body.classList.contains('light-theme')) {
        themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
      } else {
        themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
      }
    });
  }

  if (hamburgerMenu) {
    hamburgerMenu.addEventListener('click', (e) => {
      e.stopPropagation();
      sidebar.classList.add('mobile-open');
      mobileOverlay.classList.add('active');
    });
  }

  if (closeMenu) {
    closeMenu.addEventListener('click', () => {
      sidebar.classList.remove('mobile-open');
      mobileOverlay.classList.remove('active');
    });
  }

  if (mobileOverlay) {
    mobileOverlay.addEventListener('click', () => {
      sidebar.classList.remove('mobile-open');
      mobileOverlay.classList.remove('active');
    });
  }

  if (userMenuBtn) {
    userMenuBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      userDropdown.classList.toggle('show');
    });
  }

  if (logoutBtn) {
    logoutBtn.addEventListener('click', () => {
      sessionStorage.removeItem('adminLoggedIn');
      loginForm.style.display = 'block';
      adminPanel.style.display = 'none';
      usernameInput.value = '';
      passwordInput.value = '';
    });
  }

  if (addProductBtn) {
    addProductBtn.addEventListener('click', () => {
      addProductModal.style.display = 'flex';
    });
  }

  if (cancelProductBtn) {
    cancelProductBtn.addEventListener('click', () => {
      addProductModal.style.display = 'none';
    });
  }

  if (saveProductBtn) {
    saveProductBtn.addEventListener('click', saveProduct);
  }

  if (addUserBtn) {
    addUserBtn.addEventListener('click', () => {
      addUserModal.style.display = 'flex';
    });
  }

  if (cancelUserBtn) {
    cancelUserBtn.addEventListener('click', () => {
      addUserModal.style.display = 'none';
    });
  }

  if (saveUserBtn) {
    saveUserBtn.addEventListener('click', saveUser);
  }

  if (cancelEditUserBtn) {
    cancelEditUserBtn.addEventListener('click', () => {
      editUserModal.style.display = 'none';
    });
  }

  if (saveEditUserBtn) {
    saveEditUserBtn.addEventListener('click', saveEditUser);
  }

  if (cancelDeleteUserBtn) {
    cancelDeleteUserBtn.addEventListener('click', () => {
      deleteUserModal.style.display = 'none';
    });
  }

  if (confirmDeleteUserBtn) {
    confirmDeleteUserBtn.addEventListener('click', confirmDeleteUser);
  }

  document.querySelectorAll('.dashboard-card').forEach(card => {
    card.addEventListener('click', function() {
      const target = this.getAttribute('data-target');
      showSection(target);
    });
  });

  closeModalBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      addProductModal.style.display = 'none';
      addUserModal.style.display = 'none';
      editUserModal.style.display = 'none';
      deleteUserModal.style.display = 'none';
    });
  });

  document.addEventListener('click', () => {
    if (userDropdown) userDropdown.classList.remove('show');
  });

  setupMenuNavigation();
  loadData();
}

function setupMenuNavigation() {
  const menuItems = document.querySelectorAll('.sidebar-menu .menu-item');
  
  menuItems.forEach(item => {
    item.addEventListener('click', function(e) {
      e.preventDefault();
      
      menuItems.forEach(i => i.classList.remove('active'));
      this.classList.add('active');
      
      document.querySelectorAll('.section').forEach(section => {
        section.classList.remove('active');
      });
      
      const target = this.getAttribute('data-target');
      const targetSection = document.getElementById(target);
      if (targetSection) {
        targetSection.classList.add('active');
      }
      
      const pageTitle = document.getElementById("pageTitle");
      const pageTitles = {
        dashboard: 'Admin Dashboard',
        deposit: 'Manajemen Deposit',
        withdraw: 'Manajemen Penarikan',
        users: 'Semua Pengguna',
        'active-members': 'Anggota Aktif',
        products: 'Manajemen Produk',
        settings: 'Pengaturan Sistem'
      };
      if (pageTitle && pageTitles[target]) {
        pageTitle.textContent = pageTitles[target];
      }
      
      if (window.innerWidth <= 992) {
        sidebar.classList.remove('mobile-open');
        mobileOverlay.classList.remove('active');
      }
    });
  });
}

loginBtn.addEventListener('click', () => {
  const username = usernameInput.value;
  const password = passwordInput.value;
  
  if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
    sessionStorage.setItem('adminLoggedIn', 'true');
    loginError.style.display = 'none';
    checkLogin();
  } else {
    loginError.style.display = 'block';
  }
});

function formatRupiah(n) { 
  return n ? n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.') : '0';
}

async function loadData() {
  if (loaderEl) loaderEl.style.display = "flex";
  
  try {
    const usersRef = ref(db, "users/");
    onValue(usersRef, (snapshot) => {
      usersData = snapshot.val() || {};
      updateStats(usersData);
      updateTables(usersData);
      updateUsersTable(usersData);
      updateActiveMembers(usersData);
    });
    
    loadProducts();
    
  } catch (error) {
    console.error('Error loading data:', error);
    showToast('Gagal memuat data!', 'var(--danger)');
  } finally {
    if (loaderEl) loaderEl.style.display = "none";
  }
}

function updateStats(users) {
  let depositCount = 0;
  let withdrawCount = 0;
  let totalUsers = 0;
  let totalRevenue = 0;
  
  for (const userKey in users) {
    const user = users[userKey];
    totalUsers++;
    
    if (user.deposit) {
      Object.entries(user.deposit).forEach(([depositId, d]) => {
        if (d.status === "Pending") {
          depositCount++;
          totalRevenue += d.nominal || 0;
        }
      });
    }
    
    if (user.penarikan) {
      Object.entries(user.penarikan).forEach(([withdrawId, p]) => {
        if (p.status === "Pending") {
          withdrawCount++;
        }
      });
    }
  }
  
  const totalDepositEl = document.getElementById("totalDeposit");
  const totalWithdrawEl = document.getElementById("totalWithdraw");
  const totalUsersEl = document.getElementById("totalUsers");
  const totalRevenueEl = document.getElementById("totalRevenue");
  
  if (totalDepositEl) totalDepositEl.textContent = depositCount;
  if (totalWithdrawEl) totalWithdrawEl.textContent = withdrawCount;
  if (totalUsersEl) totalUsersEl.textContent = totalUsers;
  if (totalRevenueEl) totalRevenueEl.textContent = `Rp ${formatRupiah(totalRevenue)}`;
}

function updateTables(users) {
  const depositTableBody = document.getElementById("depositTableBody");
  const withdrawTableBody = document.getElementById("withdrawTableBody");
  
  if (depositTableBody) depositTableBody.innerHTML = "";
  if (withdrawTableBody) withdrawTableBody.innerHTML = "";
  
  for (const userKey in users) {
    const user = users[userKey];
    
    if (user.deposit) {
      Object.entries(user.deposit).forEach(([depositId, d]) => {
        if (d.status === "Pending") {
          const tr = document.createElement("tr");
          
          tr.innerHTML = `
            <td>${userKey}</td>
            <td>Rp ${formatRupiah(d.nominal)}</td>
            <td>${d.tanggal}</td>
            <td>
              <div class="actions-center">
                <button class="btn btn-sm btn-success"><i class="fas fa-check"></i> ACC</button>
                <button class="btn btn-sm btn-danger"><i class="fas fa-times"></i> Tolak</button>
              </div>
            </td>
          `;
          
          const [accBtn, tolakBtn] = tr.querySelectorAll("button");
          accBtn.addEventListener("click", () => handleDeposit(userKey, depositId, true));
          tolakBtn.addEventListener("click", () => handleDeposit(userKey, depositId, false));
          
          if (depositTableBody) depositTableBody.appendChild(tr);
        }
      });
    }
    
    if (user.penarikan) {
      Object.entries(user.penarikan).forEach(([withdrawId, p]) => {
        if (p.status === "Pending") {
          const tr = document.createElement("tr");
          
          tr.innerHTML = `
            <td>${userKey}</td>
            <td>Rp ${formatRupiah(p.nominal)}</td>
            <td>${p.noRekening || '-'}</td>
            <td>${p.tanggal}</td>
            <td>
              <div class="actions-center">
                <button class="btn btn-sm btn-success"><i class="fas fa-check"></i> ACC</button>
                <button class="btn btn-sm btn-danger"><i class="fas fa-times"></i> Tolak</button>
              </div>
            </td>
          `;
          
          const [accBtn, tolakBtn] = tr.querySelectorAll("button");
          accBtn.addEventListener("click", () => handleTarik(userKey, withdrawId, true));
          tolakBtn.addEventListener("click", () => handleTarik(userKey, withdrawId, false));
          
          if (withdrawTableBody) withdrawTableBody.appendChild(tr);
        }
      });
    }
  }
}

function updateUsersTable(users) {
  const usersTableBody = document.getElementById("usersTableBody");
  if (!usersTableBody) return;
  
  usersTableBody.innerHTML = "";
  
  for (const userKey in users) {
    const user = users[userKey];
    const tr = document.createElement("tr");
    
    tr.innerHTML = `
      <td>${userKey}</td>
      <td>${user.nohp || '-'}</td>
      <td>${user.email || '-'}</td>
      <td>Rp ${formatRupiah(user.saldo || 0)}</td>
      <td>
        <div class="password-field">
          <input type="password" value="${user.password || ''}" readonly>
          <button class="toggle-password" type="button">
            <i class="fas fa-eye"></i>
          </button>
        </div>
      </td>
      <td>${user.tanggalDaftar || '-'}</td>
      <td>
        <div class="actions-center">
          <button class="btn btn-sm btn-primary edit-user" data-user="${userKey}"><i class="fas fa-edit"></i> Edit</button>
          <button class="btn btn-sm btn-danger delete-user" data-user="${userKey}"><i class="fas fa-trash"></i> Hapus</button>
        </div>
      </td>
    `;
    
    const editBtn = tr.querySelector('.edit-user');
    const deleteUserBtn = tr.querySelector('.delete-user');
    const togglePasswordBtn = tr.querySelector('.toggle-password');
    const passwordInput = tr.querySelector('input[type="password"]');
    
    editBtn.addEventListener('click', () => openEditUserModal(userKey));
    deleteUserBtn.addEventListener('click', () => openDeleteUserModal(userKey));
    
    togglePasswordBtn.addEventListener('click', () => {
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        togglePasswordBtn.innerHTML = '<i class="fas fa-eye-slash"></i>';
      } else {
        passwordInput.type = 'password';
        togglePasswordBtn.innerHTML = '<i class="fas fa-eye"></i>';
      }
    });
    
    usersTableBody.appendChild(tr);
  }
}

function updateActiveMembers(users) {
  const activeMembersContainer = document.getElementById("activeMembersContainer");
  if (!activeMembersContainer) return;
  
  activeMembersContainer.innerHTML = "";
  
  for (const userKey in users) {
    const user = users[userKey];
    if (user.saldo && user.saldo > 0) {
      const memberCard = document.createElement("div");
      memberCard.className = "member-card";
      
      memberCard.innerHTML = `
        <div class="member-avatar">${userKey.charAt(0).toUpperCase()}</div>
        <div class="member-name">${userKey}</div>
        <div class="member-email">${user.email || 'Tidak ada email'}</div>
        <div class="member-stats">
          <div class="stat-item">
            <div class="stat-value">Rp ${formatRupiah(user.saldo)}</div>
            <div class="stat-label">Saldo</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">${user.deposit ? Object.keys(user.deposit).length : 0}</div>
            <div class="stat-label">Deposit</div>
          </div>
        </div>
        <div class="actions-center" style="margin-top: 15px;">
          <button class="btn btn-sm btn-primary edit-user" data-user="${userKey}"><i class="fas fa-edit"></i> Edit</button>
          <button class="btn btn-sm btn-danger delete-user" data-user="${userKey}"><i class="fas fa-trash"></i> Hapus</button>
        </div>
      `;
      
      const editBtn = memberCard.querySelector('.edit-user');
      const deleteUserBtn = memberCard.querySelector('.delete-user');
      
      editBtn.addEventListener('click', () => openEditUserModal(userKey));
      deleteUserBtn.addEventListener('click', () => openDeleteUserModal(userKey));
      
      activeMembersContainer.appendChild(memberCard);
    }
  }
}

function openEditUserModal(userKey) {
  currentUserKey = userKey;
  const user = usersData[userKey];
  
  document.getElementById('editUsername').value = userKey;
  document.getElementById('editNohp').value = user.nohp || '';
  document.getElementById('editEmail').value = user.email || '';
  document.getElementById('editPassword').value = user.password || '';
  document.getElementById('editSaldo').value = user.saldo || 0;
  document.getElementById('editReferralCode').value = user.referralCode || '';
  document.getElementById('editUpline').value = user.upline || '';
  
  editUserModal.style.display = 'flex';
}

async function saveEditUser() {
  if (!currentUserKey) return;
  
  const nohp = document.getElementById('editNohp').value;
  const email = document.getElementById('editEmail').value;
  const password = document.getElementById('editPassword').value;
  const saldo = parseInt(document.getElementById('editSaldo').value);
  const referralCode = document.getElementById('editReferralCode').value;
  const upline = document.getElementById('editUpline').value;
  
  if (isNaN(saldo)) {
    showToast('Masukkan saldo yang valid!', 'var(--warning)');
    return;
  }
  
  try {
    await update(ref(db, `users/${currentUserKey}`), {
      nohp: nohp || '',
      email: email || '',
      password: password || '',
      saldo: saldo,
      referralCode: referralCode || '',
      upline: upline || ''
    });
    
    editUserModal.style.display = 'none';
    showToast(`Data user ${currentUserKey} berhasil diubah`);
  } catch (error) {
    console.error('Error updating user:', error);
    showToast('Gagal mengubah data user!', 'var(--danger)');
  }
}

function openDeleteUserModal(userKey) {
  currentUserKey = userKey;
  document.getElementById('deleteUserMessage').textContent = `Apakah Anda yakin ingin menghapus akun ${userKey}? Semua data termasuk saldo, produk, dan riwayat transaksi akan dihapus permanen.`;
  deleteUserModal.style.display = 'flex';
}

async function confirmDeleteUser() {
  if (!currentUserKey) return;
  
  try {
    await remove(ref(db, `users/${currentUserKey}`));
    deleteUserModal.style.display = 'none';
    showToast(`Akun ${currentUserKey} berhasil dihapus!`, 'var(--success)');
  } catch (error) {
    console.error('Error deleting user:', error);
    showToast('Gagal menghapus akun!', 'var(--danger)');
  }
}

async function saveUser() {
  const username = document.getElementById("newUsername").value;
  const nohp = document.getElementById("newNohp").value;
  const password = document.getElementById("newPassword").value;
  const email = document.getElementById("newEmail").value;
  const initialBalance = parseInt(document.getElementById("initialBalance").value) || 0;
  
  if (!username || !password) {
    showToast('Username dan password harus diisi!', 'var(--warning)');
    return;
  }
  
  if (password.length < 6) {
    showToast('Password minimal 6 karakter!', 'var(--warning)');
    return;
  }
  
  try {
    const userRef = ref(db, `users/${username}`);
    const snap = await get(userRef);
    
    if (snap.exists()) {
      showToast('Username sudah digunakan!', 'var(--warning)');
      return;
    }
    
    await set(userRef, {
      username: username,
      nohp: nohp || '',
      password: password,
      email: email || '',
      saldo: initialBalance,
      tanggalDaftar: new Date().toISOString().split('T')[0],
      totalInvest: 0,
      totalKomisi: 0,
      aktifRef1: 0,
      aktifRef2: 0,
      aktifRef3: 0,
      refListLevel1: [],
      refListLevel2: [],
      refListLevel3: []
    });
    
    addUserModal.style.display = 'none';
    showToast(`User ${username} berhasil ditambahkan!`);
    
    document.getElementById("newUsername").value = '';
    document.getElementById("newNohp").value = '';
    document.getElementById("newPassword").value = '';
    document.getElementById("newEmail").value = '';
    document.getElementById("initialBalance").value = '0';
    
  } catch (error) {
    console.error('Error saving user:', error);
    showToast('Gagal menambahkan user!', 'var(--danger)');
  }
}

async function loadProducts() {
  try {
    const productsRef = ref(db, "products/");
    const snapshot = await get(productsRef);
    productsData = snapshot.val() || {};
    
    updateProductsTable(productsData);
  } catch (error) {
    console.error('Error loading products:', error);
  }
}

function updateProductsTable(products) {
  const productsContainer = document.getElementById("productsContainer");
  if (!productsContainer) return;
  
  productsContainer.innerHTML = "";
  
  for (const productKey in products) {
    const product = products[productKey];
    const productCard = document.createElement("div");
    productCard.className = "product-card";
    
    productCard.innerHTML = `
      <div class="product-header">
        <h3>${product.nama}</h3>
      </div>
      <div class="product-body">
        <div class="product-price">Rp ${formatRupiah(product.harga)}</div>
        <ul class="product-features">
          <li><i class="fas fa-check-circle"></i> Keuntungan: ${product.keuntungan}%</li>
          <li><i class="fas fa-calendar-alt"></i> Durasi: ${product.durasi} hari</li>
        </ul>
        <p>${product.deskripsi || 'Tidak ada deskripsi'}</p>
        <div class="product-actions">
          <button class="btn btn-secondary edit-product" data-key="${productKey}"><i class="fas fa-edit"></i> Edit</button>
          <button class="btn btn-danger delete-product" data-key="${productKey}"><i class="fas fa-trash"></i> Hapus</button>
        </div>
      </div>
    `;
    
    productsContainer.appendChild(productCard);
  }
  
  document.querySelectorAll('.edit-product').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const productKey = e.target.closest('.edit-product').getAttribute('data-key');
      editProduct(productKey);
    });
  });
  
  document.querySelectorAll('.delete-product').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const productKey = e.target.closest('.delete-product').getAttribute('data-key');
      deleteProduct(productKey);
    });
  });
}

async function saveProduct() {
  const productName = document.getElementById("productName").value;
  const productPrice = parseInt(document.getElementById("productPrice").value);
  const productProfit = parseInt(document.getElementById("productProfit").value);
  const productDuration = parseInt(document.getElementById("productDuration").value);
  const productDescription = document.getElementById("productDescription").value;
  
  if (!productName || !productPrice || !productProfit || !productDuration) {
    showToast('Harap isi semua field yang diperlukan!', 'var(--warning)');
    return;
  }
  
  try {
    const productId = Date.now().toString();
    await set(ref(db, `products/${productId}`), {
      nama: productName,
      harga: productPrice,
      keuntungan: productProfit,
      durasi: productDuration,
      deskripsi: productDescription
    });
    
    addProductModal.style.display = 'none';
    showToast('Produk berhasil ditambahkan!');
    
    document.getElementById("productName").value = '';
    document.getElementById("productPrice").value = '';
    document.getElementById("productProfit").value = '';
    document.getElementById("productDuration").value = '';
    document.getElementById("productDescription").value = '';
    
    loadProducts();
  } catch (error) {
    console.error('Error saving product:', error);
    showToast('Gagal menambahkan produk!', 'var(--danger)');
  }
}

async function editProduct(productKey) {
  try {
    const productRef = ref(db, `products/${productKey}`);
    const snapshot = await get(productRef);
    const product = snapshot.val();
    
    const newName = prompt("Nama produk baru:", product.nama);
    if (!newName) return;
    
    const newPrice = parseInt(prompt("Harga baru:", product.harga));
    if (!newPrice) return;
    
    const newProfit = parseInt(prompt("Keuntungan baru (%):", product.keuntungan));
    if (!newProfit) return;
    
    const newDuration = parseInt(prompt("Durasi baru (hari):", product.durasi));
    if (!newDuration) return;
    
    const newDescription = prompt("Deskripsi baru:", product.deskripsi || '');
    
    await update(ref(db, `products/${productKey}`), {
      nama: newName,
      harga: newPrice,
      keuntungan: newProfit,
      durasi: newDuration,
      deskripsi: newDescription
    });
    
    showToast('Produk berhasil diubah!');
    loadProducts();
  } catch (error) {
    console.error('Error editing product:', error);
    showToast('Gagal mengubah produk!', 'var(--danger)');
  }
}

async function deleteProduct(productKey) {
  if (!confirm('Apakah Anda yakin ingin menghapus produk ini?')) return;
  
  try {
    await remove(ref(db, `products/${productKey}`));
    showToast('Produk berhasil dihapus!');
    loadProducts();
  } catch (error) {
    console.error('Error deleting product:', error);
    showToast('Gagal menghapus produk!', 'var(--danger)');
  }
}

async function handleDeposit(userKey, depositId, isAcc) {
  if (loaderEl) loaderEl.style.display = "flex";
  
  try {
    const userRef = ref(db, "users/" + userKey);
    const snap = await get(userRef);
    const user = snap.val();
    const deposit = user.deposit[depositId];

    if (isAcc) {
      const saldo = user.saldo || 0;
      await update(ref(db, `users/${userKey}`), {
        saldo: saldo + (deposit.nominal || 0),
        [`deposit/${depositId}/status`]: "Success"
      });
      showToast(`Deposit Rp ${formatRupiah(deposit.nominal)} dari ${userKey} berhasil diterima.`);
    } else {
      await update(ref(db, `users/${userKey}`), {
        [`deposit/${depositId}/status`]: "Gagal"
      });
      showToast(`Deposit Rp ${formatRupiah(deposit.nominal)} dari ${userKey} ditolak.`, "var(--warning)");
    }
  } catch (error) {
    console.error('Error handling deposit:', error);
    showToast('Gagal memproses deposit!', 'var(--danger)');
  } finally {
    if (loaderEl) loaderEl.style.display = "none";
  }
}

async function handleTarik(userKey, withdrawId, isAcc) {
  if (loaderEl) loaderEl.style.display = "flex";
  
  try {
    const userRef = ref(db, "users/" + userKey);
    const snap = await get(userRef);
    const user = snap.val();
    const penarikan = user.penarikan[withdrawId];

    if (isAcc) {
      const withdrawalFee = Math.floor(penarikan.nominal * 0.1);
      const amountAfterFee = penarikan.nominal - withdrawalFee;
      
      await update(ref(db, `users/${userKey}`), {
        [`penarikan/${withdrawId}/status`]: "Success"
      });
      showToast(`Penarikan Rp ${formatRupiah(penarikan.nominal)} dari ${userKey} berhasil. User menerima Rp ${formatRupiah(amountAfterFee)}`);
    } else {
      const saldo = user.saldo || 0;
      await update(ref(db, `users/${userKey}`), {
        saldo: saldo + penarikan.nominal,
        [`penarikan/${withdrawId}/status`]: "Gagal"
      });
      showToast(`Penarikan Rp ${formatRupiah(penarikan.nominal)} dari ${userKey} ditolak.`, "var(--warning)");
    }
  } catch (error) {
    console.error('Error handling withdrawal:', error);
    showToast('Gagal memproses penarikan!', 'var(--danger)');
  } finally {
    if (loaderEl) loaderEl.style.display = "none";
  }
}

checkLogin();
</script>
</body>
</html>